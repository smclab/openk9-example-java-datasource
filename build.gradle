/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/6.7/samples
 */

buildscript {
	repositories {
		maven {
			url "https://plugins.gradle.org/m2/"
		}
	}
	dependencies {
		classpath 'net.saliman:gradle-properties-plugin:1.5.1'
		classpath "org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:3.1.1"
	}
}

apply plugin: 'net.saliman.properties'

apply from: "build-dist.gradle"

def allDependencies = configurations
		.findAll({it.name.startsWith("dist")})
		.collect({ it.dependencies})
		.flatten()

def conf = configurations.create("tmp")

conf.dependencies.addAll(allDependencies)

task buildDist(type: Copy) {
	from(conf)
	into "$rootDir/build/libs"
}

if (properties.get("karafDir") != null) {
	task deployDist(type: Copy) {
		from(conf)
		into "$karafDir/deploy"
	}
}
task cleanDist(type: Delete) {
	delete("$rootDir/build")
}

clean.dependsOn(cleanDist)
